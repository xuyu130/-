<!-- 课程管理-课程列表-查看学生 -->
{% extends 'layout.html' %}

{% block title %}课程 "{{ course.name }}" 的学生{% endblock %}

{% block content %}
<h1 class="mb-4">课程 "{{ course.name }}" 的学生</h1>

<p><strong>描述:</strong> {{ course.description or '暂无描述' }}</p>
<p><strong>学分:</strong> {{ course.credits or 'N/A' }}</p>
<p><strong>容量:</strong> {{ course.enrolled_count or 0 }} / {{ course.capacity or '不限' }}</p>

<h4 class="mt-4">已选学生列表</h4>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>学号</th>
                <th>姓名</th>
                <th>性别</th>
                <th>班级</th>
                <th>考试成绩</th>
                <th>表现成绩</th>
                {% if session.get('role') in ['admin', 'teacher'] %}
                <th>操作</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
            <tr>
                <td>{{ student.student_id }}</td>
                <td><a href="{{ url_for('enrollments', student_id=student.id) }}">{{ student.name }}</a></td>
                <td>{{ student.gender }}</td>
                <td>{{ student.class_name }}</td>
                <td>{{ student.exam_score or 'N/A' }}</td>
                <td>{{ student.performance_score or 'N/A' }}</td>
                {% if session.get('role') in ['admin', 'teacher'] %}
                <td>
                    <!-- 添加编辑成绩的链接 -->
                    {% for enrollment in enrollments %}
                        {% if enrollment.student_id == student.id and enrollment.course_id == course.id %}
                            <!-- 修改这里：添加referrer参数 -->
                            <a href="{{ url_for('edit_enrollment', enrollment_id=enrollment.id) }}?referrer={{ request.url | urlencode }}" class="btn btn-sm btn-warning">编辑成绩</a>
                        {% endif %}
                    {% endfor %}
                </td>
                {% endif %}
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="text-center text-muted">暂无学生选修此课程。</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<a href="{{ url_for('courses') }}" class="btn btn-secondary mt-3">返回课程列表</a>
{% endblock %}